@model appMonumentos.Models.Monumento
@using Microsoft.AspNetCore.Identity
@using System.Security.Claims

@{
    ViewData["Title"] = "Detalhes do Monumento";

    var imagemPrincipal = Model.Imagens?.FirstOrDefault(i => i.IsPrincipal);
    var imagensSecundarias = Model.Imagens?.Where(i => !i.IsPrincipal).ToList() ?? new List<appMonumentos.Models.Imagem>();

    var userAuthenticated = User.Identity != null && User.Identity.IsAuthenticated;
}

<h2>@Model.Designacao</h2>

<!-- Mensagens de sucesso ou erro -->
@if (TempData["Erro"] != null)
{
    <div style="color: red; font-weight: bold;">@TempData["Erro"]</div>
}
@if (TempData["Sucesso"] != null)
{
    <div style="color: green; font-weight: bold;">@TempData["Sucesso"]</div>
}

<!-- Imagem Principal -->
<div>
    <h4>Imagem Principal:</h4>
    @if (imagemPrincipal != null)
    {
        <img src="~/imagens/@imagemPrincipal.NomeImagem" alt="Imagem Principal" width="400" />
    }
    else
    {
        <div style="width:400px; height:250px; background-color:lightgray; text-align:center; line-height:250px;">
            Sem imagem principal
        </div>
    }
</div>

<!-- Upload de Imagem (apenas para utilizadores autenticados) -->
@if (userAuthenticated)
{
    <h4>Enviar nova imagem:</h4>
    <form asp-action="UploadImagem" method="post" enctype="multipart/form-data">
        <input type="hidden" name="monumentoId" value="@Model.Id" />
        <input type="file" name="imagem" required />
        <button type="submit">Enviar Imagem</button>
    </form>
}
else
{
    <p><i>Inicie sessão para enviar imagens.</i></p>
}

<!-- Imagens Secundárias -->
@if (imagensSecundarias.Any())
{
    <h4>Imagens dos Utilizadores:</h4>
    <div>
        @foreach (var img in imagensSecundarias)
        {
            <img src="~/imagens/@img.NomeImagem" alt="Imagem Secundária" width="150" style="margin: 5px;" />
        }
    </div>
}